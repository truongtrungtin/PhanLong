@model IEnumerable<QLDL.EF.DMBill>
@{
    ViewBag.Title = "Danh mục Bill";
    Layout = "~/Views/Shared/_Layout.cshtml";

}

<div class="card h-100">
    <div class="card-body no-gutters">
        <h4>
            <b>Danh Mục Bill</b>
            @Html.ActionLink("Thêm Bill", "Create", null, new { @class = "btn btn-primary mb-1" })
        </h4>
        <div class="table-responsive">
            @using (Html.BeginForm("Index", "DMBill", FormMethod.Post))
            {
                <table class="table table-bordered table-striped" id="dataTable" width="100%">
                    <thead>
                        <tr>
                            <th width="1%"><input type='checkbox' id='check' value='' /></th>
                            <th></th>
                            <th>Mã Bill</th>
                            <th>Tàu đến</th>
                            <th>Khách Hàng</th>
                            <th>Cảng Nhận</th>
                            <th>Cảng Trả</th>
                            <th>Hạn Lưu Bãi</th>
                            <th>Trạng thái lưu bãi</th>
                            <th>Hạn Lưu Cont</th>
                            <th>Trạng thái lưu Cont</th>
                            <th>Hạn Lưu Rỗng</th>
                            <th>Trạng thái rỗng</th>
                            <th>#</th>
                        </tr>
                    </thead>
                    <tbody>

                        @foreach (var item in Model)
                        {
                        <tr id="row_@item.Id">

                            <td width="1%"><input type='checkbox' name='chkId[]' id='checkbox' value="@item.Id" /></td>
                            <td width="1%">@Html.ActionLink("Chi tiết", "CTBill", new { id = item.Id }, new { @class = "btn btn-primary mb-1" })</td>
                            <td>@Html.ActionLink(item.MaBill, "CTBill", new { id = item.Id })</td>
                            <td>@(item.NgayTauDen != null ? item.NgayTauDen.Value.ToShortDateString() : null)</td>
                            <td>@item.DMKhachHang.TenCongTy</td>
                            <td>@item.DMCang.TenCang</td>
                            <td>@item.DMCang1.TenCang</td>
                            @{ var hanluubai = item.CTBills.Where(x => x.Bill == item.Id).FirstOrDefault();}
                            <td> @(hanluubai != null ? hanluubai.HanLuuBai.Value.ToShortDateString() : null)</td>
                            @{ var b = item.CTBills.Where(x => x.TrangThaiLuuBai == true).ToList(); }
                            <td style=@( b.Count > 0 ? "color:red" : null)> @( b.Count > 0 ? "Còn"  : "Hết" )</td>
                            @{ var hanluucont = item.CTBills.Where(x => x.Bill == item.Id).FirstOrDefault();}
                            <td> @(hanluucont != null ? hanluucont.HanLuuCont.Value.ToShortDateString() : null)</td>
                            @{ var c = item.CTBills.Where(x => x.TrangThaiLuuCont == true).ToList(); }
                            <td style=@( c.Count > 0 ? "color:red" : null)> @( c.Count > 0 ? "Còn"  : "Hết" )</td>
                            @{ var hanluurong = item.CTBills.Where(x => x.Bill == item.Id).FirstOrDefault();}
                            <td> @(hanluurong != null ? hanluurong.HanLuuRong.Value.ToShortDateString() : null)</td>
                            @{ var r = item.CTBills.Where(x => x.TrangThaiLuuRong == true).ToList(); }
                            <td style=@( r.Count > 0 ? "color:red" : null)> @( r.Count > 0 ? "Còn"  : "Hết" )</td>
                            <td>
                                @Html.ActionLink("Chỉnh sửa", "Update", new { id = item.Id }, new { @class = "btn btn-primary mb-1" })
                            </td>
                        </tr>
                        }
                    </tbody>

                </table>
                <div class="form-group">
                    <input type="submit" value="Xóa" name="delete" id="delete" class="btn btn-warning" />
                </div>
            }
        </div>
    </div>
</div>




