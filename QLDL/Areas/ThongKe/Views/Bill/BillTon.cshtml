@model List<QLDL.EF.DMBill>
@{
    var stt = 0;
}
<div class="card h-100">
    <div class="card-body no-gutters">
        <div class="table-responsive">
            <h4><b>Bill có cont chưa giao</b></h4>
            <table class="table table-bordered table-hover table-striped" id="table"
                   data-pagination="true"
                   data-toggle="table"
                   data-search="true"
                   data-method="post"
                   width="100%">
                <thead>
                    <tr>
                        <th></th>
                        <th data-field="stt" data-sortable="true">STT</th>
                        <th>Mã Bill</th>
                        <th data-field="Cont" data-sortable="true">Tổng Cont</th>
                        <th data-sortable="true">Số cont chưa giao</th>
                        <th data-sortable="true">Trạng thái Lưu Bãi (Ngày)</th>
                        <th data-sortable="true">Trạng thái Lưu Cont (Ngày)</th>
                        <th data-sortable="true">Trạng thái Lưu Rỗng (Ngày)</th>
                    </tr>
                </thead>
                <tbody>

                    @foreach (var item in Model)
                    {
                        var songay = item.CTBills.Where(x => x.Bill == item.Id && x.NgayGiao == null).ToList();
                        if (songay.Count() > 0 || item.CTBills.Count() == 0)
                        {
                            stt += 1;
                    <tr>
                        <td>@Html.ActionLink("Chi tiết", "CTBillTon", new { id = item.Id }, new { @class = "btn btn-primary" })</td>
                        <td>@stt</td>
                        <td>@item.MaBill</td>
                        <td>@item.CTBills.Where(x => x.Bill == item.Id).ToList().Count()</td>
                        <td>@songay.Count()</td>
                        @{ var day = item.CTBills.Where(x => x.Bill == item.Id).OrderByDescending(x => x.NgayGiao).FirstOrDefault();}
                        @if (item.CTBills.Count() > 0)
                        {
                            if (day.HanLuuBai != null)
                            {
                                var ngayluubai = (day.HanLuuBai.Value.Date - DateTime.Now.Date).TotalDays;
                                if (ngayluubai == 0)
                                {
                                    <td style="color:red">Tới hạn</td>

                                }
                                else
                                {
                                    <td style="color:red"> @(ngayluubai > 0 ? "Còn( " + ngayluubai + " Ngày)" : "Quá hạn ( " +  Math.Abs(ngayluubai) + " Ngày)")</td>

                                }
                            }
                            else
                            {
                                <td>Chưa có hạn lưu Bãi</td>
                            }

                            if (day.HanLuuCont != null)
                            {
                                var ngayluucont = (day.HanLuuCont.Value.Date - DateTime.Now.Date).TotalDays;
                                if (ngayluucont == 0)
                                {
                                    <td style="color:red">Tới hạn</td>

                                }
                                else
                                {
                                    <td style="color:red"> @(ngayluucont > 0 ? "Còn( " + ngayluucont + " Ngày)" : "Quá hạn ( " +  Math.Abs(ngayluucont) + " Ngày)")</td>

                                }
                            }
                            else
                            {
                                <td>Chưa có hạn lưu cont</td>
                            }
                            if (day.HanLuuRong != null)
                            {
                                var ngayluurong = (day.HanLuuRong.Value.Date - DateTime.Now.Date).TotalDays;
                                if (ngayluurong == 0)
                                {
                                    <td style="color:red ">Tới hạn</td>

                                }
                                else
                                {
                                    <td style="color:red"> @(ngayluurong > 0 ? "Còn( " + ngayluurong + " Ngày)" : "Quá hạn ( " +  Math.Abs(ngayluurong) + " Ngày)")</td>

                                }
                            }
                            else
                            {
                                <td>chưa có hạn lưu rỗng</td>
                            }
                        }
                        else
                        {
                            <td>Chưa có cont</td>
                            <td>Chưa có cont</td>
                            <td>Chưa có cont</td>
                        }


                    </tr>
                        }

                    }
                </tbody>

            </table>


        </div>
    </div>
</div>

