@model List<QLDL.EF.DMBill>
@{
    ViewBag.Title = "Bill tồn";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var stt = 0;
}
<div class="card h-100">
    <div class="card-body no-gutters">
        <div class="table-responsive">
            <h4><b>Số Bill Còn</b></h4>
            <table class="table table-bordered table-striped" id="dataTable" width="100%">
                <thead>
                    <tr>
                        <th></th>
                        <th>STT</th>
                        <th>Mã Bill</th>
                        <th>Tổng Cont</th>
                        <th>Số cont tồn</th>
                        <th>Trạng thái Lưu Bãi (Ngày)</th>
                        <th>Trạng thái Lưu Cont (Ngày)</th>
                        <th>Trạng thái Lưu Rỗng (Ngày)</th>
                    </tr>
                </thead>
                <tbody>
                  
                    @foreach (var item in Model)
                    {
                        var songay = item.CTBills.Where(x => x.Bill == item.Id && (x.HanLuuBai.Value.Date < DateTime.Now.Date || x.HanLuuCont.Value.Date < DateTime.Now.Date || x.HanLuuRong < DateTime.Now) && x.NgayGiao == null).ToList();
                        if (songay.Count() > 0)
                        {
                            stt += 1;
                            <tr>
                                <td>@Html.ActionLink("Chi tiết", "CTBill", new { id = item.Id }, new { @class = "btn btn-primary" })</td>
                                <td>@stt</td>
                                <td>@item.MaBill</td>
                                <td>@item.CTBills.Where(x => x.Bill == item.Id).ToList().Count()</td>

                                <td>@songay.Count()</td>
                                @{ var day = item.CTBills.Where(x => x.Bill == item.Id).FirstOrDefault();
                                    var ngayluubai = (day.HanLuuBai.Value.Date - DateTime.Now.Date).TotalDays;}
                                <td style="color:red"> Còn( @ngayluubai Ngày)</td>
                                @{ var ngayluucont = (day.HanLuuCont.Value.Date - DateTime.Now.Date).TotalDays;}
                                <td style="color:red"> Còn( @ngayluucont Ngày)</td>
                                @if (day.HanLuuRong != null)
                                {
                                    var ngayluurong = (day.HanLuuRong.Value.Date - DateTime.Now.Date).TotalDays;
                                    <td style="color:red"> Còn( @ngayluurong Ngày)</td>
                                }
                                else
                                {
                                    <td></td>
                                }

                            </tr>
                        }

                    }
                </tbody>

            </table>


        </div>
    </div>
</div>

